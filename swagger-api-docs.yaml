openapi: 3.0.3
info:
  title: Mini Chat Bar API
  description: ä¸€ä¸ªåŸºäºVue 3 + Express + Socket.IOçš„ç°ä»£åŒ–èŠå¤©åº”ç”¨APIæ–‡æ¡£
  version: 1.0.0
  contact:
    name: Mini Chat Bar Team
    email: support@minichatbar.com

servers:
  - url: http://localhost:3000
    description: å¼€å‘ç¯å¢ƒ
  - url: https://api.minichatbar.com
    description: ç”Ÿäº§ç¯å¢ƒ

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Tokenè®¤è¯

  schemas:
    User:
      type: object
      properties:
        uID:
          type: string
          description: ç”¨æˆ·å”¯ä¸€ID
        uName:
          type: string
          description: ç”¨æˆ·å
        uEmail:
          type: string
          format: email
          description: ç”¨æˆ·é‚®ç®±
        uAvatar:
          type: string
          description: ç”¨æˆ·å¤´åƒURL
        Friends:
          type: array
          items:
            type: string
          description: å¥½å‹IDåˆ—è¡¨

    Message:
      type: object
      properties:
        _id:
          type: string
          description: æ¶ˆæ¯ID
        from:
          type: string
          description: å‘é€è€…ID
        to:
          type: string
          description: æ¥æ”¶è€…ID
        content:
          type: string
          description: æ¶ˆæ¯å†…å®¹
        messageType:
          type: string
          enum: [text, image, file, voice]
          description: æ¶ˆæ¯ç±»å‹
        time:
          type: string
          format: date-time
          description: å‘é€æ—¶é—´
        fileInfo:
          type: object
          properties:
            fileName:
              type: string
            fileUrl:
              type: string
            fileSize:
              type: number
            fileType:
              type: string

    GroupMessage:
      type: object
      properties:
        _id:
          type: string
          description: æ¶ˆæ¯ID
        roomId:
          type: string
          description: ç¾¤èŠID
        from:
          type: string
          description: å‘é€è€…ID
        fromName:
          type: string
          description: å‘é€è€…åç§°
        fromAvatar:
          type: string
          description: å‘é€è€…å¤´åƒ
        content:
          type: string
          description: æ¶ˆæ¯å†…å®¹
        messageType:
          type: string
          enum: [text, image, file, voice, system]
        timestamp:
          type: string
          format: date-time

    Room:
      type: object
      properties:
        RoomID:
          type: string
          description: ç¾¤èŠID
        RoomName:
          type: string
          description: ç¾¤èŠåç§°
        Creator:
          type: string
          description: åˆ›å»ºè€…ID
        Admins:
          type: array
          items:
            type: string
          description: ç®¡ç†å‘˜IDåˆ—è¡¨
        Members:
          type: array
          items:
            type: object
            properties:
              userID:
                type: string
              Nickname:
                type: string
              Avatar:
                type: string
              joinedAt:
                type: string
                format: date-time

    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
        error:
          type: string

security:
  - bearerAuth: []

paths:
  # WebSocket äº‹ä»¶ä¿¡æ¯
  /websocket/events:
    get:
      tags:
        - WebSocketäº‹ä»¶
      summary: WebSocketäº‹ä»¶è¯´æ˜æ–‡æ¡£
      description: |
        ## Socket.IO å®æ—¶é€šä¿¡äº‹ä»¶æ–‡æ¡£
        
        **è¿æ¥åœ°å€**: `ws://localhost:3000` (å¼€å‘ç¯å¢ƒ) æˆ– `wss://your-domain.com` (ç”Ÿäº§ç¯å¢ƒ)
        
        ### ğŸ”Œ è¿æ¥ç®¡ç†äº‹ä»¶
        
        **å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯**:
        - `connect` - è‡ªåŠ¨è§¦å‘ï¼Œå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨
        - `login` - ç”¨æˆ·ç™»å½•äº‹ä»¶ï¼Œå‚æ•°: userId (string)
        - `user-online` - ç”¨æˆ·ä¸»åŠ¨ä¸Šçº¿ï¼Œå‚æ•°: userId (string)  
        - `user-offline` - ç”¨æˆ·ä¸»åŠ¨ç¦»çº¿ï¼Œå‚æ•°: userId (string)
        - `disconnect` - è‡ªåŠ¨è§¦å‘ï¼Œå®¢æˆ·ç«¯æ–­å¼€è¿æ¥
        
        **æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯**:
        - `user-online-notification` - ç”¨æˆ·ä¸Šçº¿é€šçŸ¥ï¼Œæ•°æ®: userId (string)
        - `user-offline-notification` - ç”¨æˆ·ç¦»çº¿é€šçŸ¥ï¼Œæ•°æ®: userId (string)
        - `online-users-update` - åœ¨çº¿ç”¨æˆ·åˆ—è¡¨æ›´æ–°ï¼Œæ•°æ®: userIds (string[])
        
        ### ğŸ’¬ ç§èŠæ¶ˆæ¯äº‹ä»¶
        
        **å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯**:
        - `private-message` - å‘é€ç§èŠæ¶ˆæ¯
        - `private-file-message` - å‘é€ç§èŠæ–‡ä»¶æ¶ˆæ¯
        - `message-deleted` - åˆ é™¤å•æ¡æ¶ˆæ¯
        - `messages-deleted` - æ‰¹é‡åˆ é™¤æ¶ˆæ¯
        
        **æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯**:
        - `private-message` - æ¥æ”¶ç§èŠæ¶ˆæ¯
        - `private-file-message` - æ¥æ”¶æ–‡ä»¶æ¶ˆæ¯
        - `message-deleted` - æ¶ˆæ¯åˆ é™¤é€šçŸ¥
        - `private-message-recalled` - æ¶ˆæ¯æ’¤å›é€šçŸ¥
        - `avatar-updated` - å¤´åƒæ›´æ–°é€šçŸ¥
        
        ### ğŸ‘¥ ç¾¤èŠæ¶ˆæ¯äº‹ä»¶
        
        **å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯**:
        - `join-group` - åŠ å…¥ç¾¤èŠ
        - `leave-group` - ç¦»å¼€ç¾¤èŠ
        - `group-message` - å‘é€ç¾¤èŠæ¶ˆæ¯
        - `group-message-read` - æ ‡è®°ç¾¤æ¶ˆæ¯å·²è¯»
        - `group-typing` - å¼€å§‹è¾“å…¥çŠ¶æ€
        - `group-stop-typing` - åœæ­¢è¾“å…¥çŠ¶æ€
        - `group-message-recall` - æ’¤å›ç¾¤èŠæ¶ˆæ¯
        
        **æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯**:
        - `member-joined` - æˆå‘˜åŠ å…¥é€šçŸ¥
        - `member-left` - æˆå‘˜ç¦»å¼€é€šçŸ¥
        - `online-count` - åœ¨çº¿äººæ•°æ›´æ–°
        - `group-message` - æ¥æ”¶ç¾¤èŠæ¶ˆæ¯
        - `group-message-read` - ç¾¤æ¶ˆæ¯å·²è¯»é€šçŸ¥
        - `group-typing` - æœ‰äººæ­£åœ¨è¾“å…¥
        - `group-stop-typing` - åœæ­¢è¾“å…¥é€šçŸ¥
        - `group-message-recalled` - ç¾¤æ¶ˆæ¯æ’¤å›é€šçŸ¥
        
        ### âš ï¸ é”™è¯¯äº‹ä»¶
        
        - `error` - æœåŠ¡ç«¯é”™è¯¯é€šçŸ¥ï¼Œæ•°æ®: { message: string, code?: string, details?: any }
        
        ### ğŸ“ è¿æ¥ç¤ºä¾‹ä»£ç 
        
        ```javascript
        import { io } from 'socket.io-client'
        
        const socket = io('http://localhost:3000', {
          withCredentials: true,
          transports: ['websocket', 'polling']
        })
        
        // ç™»å½•
        socket.emit('login', localStorage.getItem('userId'))
        
        // ç›‘å¬æ¶ˆæ¯
        socket.on('private-message', (data) => {
          console.log('æ”¶åˆ°ç§èŠæ¶ˆæ¯:', data)
        })
        
        // å‘é€æ¶ˆæ¯
        socket.emit('private-message', {
          from: 'user1',
          to: 'user2', 
          content: 'ä½ å¥½',
          messageType: 'text',
          timestamp: new Date().toISOString()
        })
        
        // åŠ å…¥ç¾¤èŠ
        socket.emit('join-group', {
          roomId: 'group_123',
          userId: 'user1'
        })
        ```
        
        ### ğŸ“‹ æ³¨æ„äº‹é¡¹
        
        1. **è¿æ¥åœ°å€**: ws://localhost:3000 (å¼€å‘ç¯å¢ƒ)
        2. **æ”¯æŒå¤šè®¾å¤‡ç™»å½•**: ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªsocketè¿æ¥
        3. **æ¶ˆæ¯å¯é æ€§**: ç§èŠæ¶ˆæ¯é‡‡ç”¨HTTP+SocketåŒè½¨åˆ¶
        4. **ç¾¤èŠæˆ¿é—´**: ä½¿ç”¨Socket.IOçš„roomæœºåˆ¶
        5. **è®¤è¯**: è¿æ¥åéœ€è¦å‘é€loginäº‹ä»¶è¿›è¡Œèº«ä»½éªŒè¯
        6. **é”™è¯¯å¤„ç†**: æ‰€æœ‰äº‹ä»¶éƒ½åŒ…å«é€‚å½“çš„é”™è¯¯å¤„ç†
      responses:
        '200':
          description: WebSocketäº‹ä»¶æ–‡æ¡£ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "è¯·æŸ¥çœ‹ä¸Šæ–¹æè¿°äº†è§£WebSocketäº‹ä»¶è¯¦æƒ…"
                  connection_url:
                    type: string
                    example: "ws://localhost:3000"
                  supported_events:
                    type: array
                    items:
                      type: string
                    example: ["login", "private-message", "group-message", "join-group"]

  # ç”¨æˆ·è®¤è¯ç›¸å…³
  /api/user/register-email:
    post:
      tags:
        - ç”¨æˆ·è®¤è¯
      summary: é‚®ç®±éªŒè¯ç æ³¨å†Œ
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - uName
                - uEmail
                - uPassword
                - verificationCode
              properties:
                uName:
                  type: string
                  description: ç”¨æˆ·å
                uEmail:
                  type: string
                  format: email
                  description: é‚®ç®±åœ°å€
                uPassword:
                  type: string
                  minLength: 8
                  description: å¯†ç 
                verificationCode:
                  type: string
                  description: é‚®ç®±éªŒè¯ç 
      responses:
        '200':
          description: æ³¨å†ŒæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
        '409':
          description: ç”¨æˆ·åæˆ–é‚®ç®±å·²å­˜åœ¨

  /api/user/login-email:
    post:
      tags:
        - ç”¨æˆ·è®¤è¯
      summary: é‚®ç®±å¯†ç ç™»å½•
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "ç™»å½•æˆåŠŸ"
                  token:
                    type: string
                    description: JWT Token
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        description: ç”¨æˆ·ID
                        example: "1642345678901"
                      name:
                        type: string
                        description: ç”¨æˆ·å
                        example: "å¼ ä¸‰"
                      email:
                        type: string
                        format: email
                        description: ç”¨æˆ·é‚®ç®±
                        example: "zhangsan@example.com"
                      ava:
                        type: string
                        description: ç”¨æˆ·å¤´åƒURL
                        example: "/images/avatar/default-avatar.webp"
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€"
        '401':
          description: å¯†ç é”™è¯¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "å¯†ç é”™è¯¯"
        '404':
          description: é‚®ç®±æœªæ³¨å†Œ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "é‚®ç®±æœªæ³¨å†Œ"

  /api/user/login-code:
    post:
      tags:
        - ç”¨æˆ·è®¤è¯
      summary: é‚®ç®±éªŒè¯ç ç™»å½•
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - verificationCode
              properties:
                email:
                  type: string
                  format: email
                verificationCode:
                  type: string
      responses:
        '200':
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "ç™»å½•æˆåŠŸ"
                  token:
                    type: string
                    description: JWT Token
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        description: ç”¨æˆ·ID
                        example: "1642345678901"
                      name:
                        type: string
                        description: ç”¨æˆ·å
                        example: "å¼ ä¸‰"
                      email:
                        type: string
                        format: email
                        description: ç”¨æˆ·é‚®ç®±
                        example: "zhangsan@example.com"
                      ava:
                        type: string
                        description: ç”¨æˆ·å¤´åƒURL
                        example: "/images/avatar/default-avatar.webp"
        '400':
          description: éªŒè¯ç é”™è¯¯æˆ–è¿‡æœŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ"
        '404':
          description: é‚®ç®±æœªæ³¨å†Œ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "é‚®ç®±æœªæ³¨å†Œ"

  /api/user/send-verification:
    post:
      tags:
        - ç”¨æˆ·è®¤è¯
      summary: å‘é€é‚®ç®±éªŒè¯ç 
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - type
              properties:
                email:
                  type: string
                  format: email
                type:
                  type: string
                  enum: [register, login]
      responses:
        '200':
          description: éªŒè¯ç å‘é€æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±"
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€"
        '409':
          description: é‚®ç®±å·²è¢«æ³¨å†Œ(ä»…æ³¨å†Œæ—¶)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "é‚®ç®±å·²è¢«æ³¨å†Œ"
        '404':
          description: é‚®ç®±æœªæ³¨å†Œ(ä»…ç™»å½•æ—¶)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "é‚®ç®±æœªæ³¨å†Œ"

  # OAuthè®¤è¯
  /auth/google:
    get:
      tags:
        - OAuthè®¤è¯
      summary: Google OAuthç™»å½•
      security: []
      responses:
        '302':
          description: é‡å®šå‘åˆ°Google OAuthæˆæƒé¡µé¢

  /auth/google/callback:
    get:
      tags:
        - OAuthè®¤è¯
      summary: Google OAuthå›è°ƒ
      security: []
      parameters:
        - name: code
          in: query
          schema:
            type: string
      responses:
        '302':
          description: é‡å®šå‘å›å‰ç«¯å¹¶æºå¸¦token

  /auth/github:
    get:
      tags:
        - OAuthè®¤è¯  
      summary: GitHub OAuthç™»å½•
      security: []
      responses:
        '302':
          description: é‡å®šå‘åˆ°GitHub OAuthæˆæƒé¡µé¢

  # ç”¨æˆ·ä¿¡æ¯ç®¡ç†
  /api/user/info:
    get:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
      responses:
        '200':
          description: æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      uID:
                        type: string
                        description: ç”¨æˆ·ID
                        example: "1642345678901"
                      uName:
                        type: string
                        description: ç”¨æˆ·å
                        example: "å¼ ä¸‰"
                      uEmail:
                        type: string
                        format: email
                        description: ç”¨æˆ·é‚®ç®±
                        example: "zhangsan@example.com"
                      uAvatar:
                        type: string
                        description: ç”¨æˆ·å¤´åƒURL
                        example: "/images/avatar/default-avatar.webp"
                      Friends:
                        type: array
                        items:
                          type: string
                        description: å¥½å‹IDåˆ—è¡¨
                        example: ["1642345678902", "1642345678903"]
        '401':
          description: æœªæˆæƒï¼ŒTokenæ— æ•ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Token æ— æ•ˆæˆ–å·²è¿‡æœŸ"

  /api/user/friends:
    get:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: è·å–å¥½å‹åˆ—è¡¨
      responses:
        '200':
          description: æˆåŠŸè·å–å¥½å‹åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  friends:
                    type: array
                    items:
                      type: object
                      properties:
                        uID:
                          type: string
                          description: å¥½å‹ç”¨æˆ·ID
                          example: "1642345678902"
                        uName:
                          type: string
                          description: å¥½å‹ç”¨æˆ·å
                          example: "æå››"
                        uEmail:
                          type: string
                          format: email
                          description: å¥½å‹é‚®ç®±
                          example: "lisi@example.com"
                        uAvatar:
                          type: string
                          description: å¥½å‹å¤´åƒURL
                          example: "/images/avatar/user-avatar.webp"
                        isOnline:
                          type: boolean
                          description: æ˜¯å¦åœ¨çº¿
                          example: true

  /api/user/add:
    post:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: æ·»åŠ å¥½å‹
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                friendId:
                  type: string
      responses:
        '200':
          description: æ·»åŠ å¥½å‹æˆåŠŸ

  /api/user/avatar:
    put:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: æ›´æ–°ç”¨æˆ·å¤´åƒ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                avatar:
                  type: string
      responses:
        '200':
          description: å¤´åƒæ›´æ–°æˆåŠŸ

  # ç§èŠç›¸å…³
  /api/chat/messages/{id}:
    get:
      tags:
        - ç§èŠ
      summary: è·å–ä¸æŒ‡å®šç”¨æˆ·çš„èŠå¤©è®°å½•
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: å¯¹æ–¹ç”¨æˆ·ID
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: é¡µç 
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
          description: æ¯é¡µæ¶ˆæ¯æ•°é‡
      responses:
        '200':
          description: æˆåŠŸè·å–èŠå¤©è®°å½•
          content:
            application/json:
              schema:
                type: object
                properties:
                  messages:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          description: æ¶ˆæ¯ID
                          example: "507f1f77bcf86cd799439011"
                        from:
                          type: string
                          description: å‘é€è€…ID
                          example: "1642345678901"
                        to:
                          type: string
                          description: æ¥æ”¶è€…ID
                          example: "1642345678902"
                        content:
                          type: string
                          description: æ¶ˆæ¯å†…å®¹
                          example: "ä½ å¥½ï¼Œæœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ"
                        messageType:
                          type: string
                          enum: [text, image, file, voice]
                          description: æ¶ˆæ¯ç±»å‹
                          example: "text"
                        time:
                          type: string
                          format: date-time
                          description: å‘é€æ—¶é—´
                          example: "2024-01-15T10:30:00.000Z"
                        fileInfo:
                          type: object
                          description: æ–‡ä»¶ä¿¡æ¯ï¼ˆä»…æ–‡ä»¶æ¶ˆæ¯ï¼‰
                          properties:
                            fileName:
                              type: string
                              example: "document.pdf"
                            fileUrl:
                              type: string
                              example: "/uploads/file-123456.pdf"
                            fileSize:
                              type: number
                              example: 1024000
                            fileType:
                              type: string
                              example: "application/pdf"
                  pagination:
                    type: object
                    properties:
                      current:
                        type: integer
                        example: 1
                      total:
                        type: integer
                        example: 5
                      count:
                        type: integer
                        example: 248
                      limit:
                        type: integer
                        example: 50

    post:
      tags:
        - ç§èŠ
      summary: å‘é€ç§èŠæ¶ˆæ¯
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: æ¥æ”¶è€…ç”¨æˆ·ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                  description: æ¶ˆæ¯å†…å®¹
                messageType:
                  type: string
                  enum: [text, image, file, voice]
                  default: text
      responses:
        '200':
          description: æ¶ˆæ¯å‘é€æˆåŠŸ

    delete:
      tags:
        - ç§èŠ
      summary: åˆ é™¤ä¸æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰èŠå¤©è®°å½•
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ

  /api/chat/search:
    get:
      tags:
        - ç§èŠ
      summary: æœç´¢èŠå¤©è®°å½•
      parameters:
        - name: keyword
          in: query
          required: true
          schema:
            type: string
        - name: targetUser
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: æœç´¢ç»“æœ

  /api/chat/search/users:
    get:
      tags:
        - ç§èŠ
      summary: æœç´¢ç”¨æˆ·
      parameters:
        - name: keyword
          in: query
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: æœç´¢ç»“æœ

  # ç¾¤èŠç›¸å…³
  /room/create:
    post:
      tags:
        - ç¾¤èŠ
      summary: åˆ›å»ºç¾¤èŠ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - groupName
              properties:
                groupName:
                  type: string
                  description: ç¾¤èŠåç§°
                memberIds:
                  type: array
                  items:
                    type: string
                  description: åˆå§‹æˆå‘˜IDåˆ—è¡¨
      responses:
        '200':
          description: ç¾¤èŠåˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  room:
                    $ref: '#/components/schemas/Room'

  /room/list:
    get:
      tags:
        - ç¾¤èŠ
      summary: è·å–ç”¨æˆ·æ‰€æœ‰ç¾¤èŠ
      responses:
        '200':
          description: æˆåŠŸè·å–ç¾¤èŠåˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  groups:
                    type: array
                    items:
                      $ref: '#/components/schemas/Room'

  /room/{roomId}:
    get:
      tags:
        - ç¾¤èŠ
      summary: è·å–ç¾¤èŠè¯¦æƒ…
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸè·å–ç¾¤èŠè¯¦æƒ…

    put:
      tags:
        - ç¾¤èŠ
      summary: æ›´æ–°ç¾¤èŠä¿¡æ¯
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                RoomName:
                  type: string
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ

  /room/{roomId}/messages:
    get:
      tags:
        - ç¾¤èŠ
      summary: è·å–ç¾¤èŠæ¶ˆæ¯
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: æˆåŠŸè·å–ç¾¤èŠæ¶ˆæ¯

    post:
      tags:
        - ç¾¤èŠ
      summary: å‘é€ç¾¤èŠæ¶ˆæ¯
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                messageType:
                  type: string
                  enum: [text, image, file, voice]
                  default: text
      responses:
        '200':
          description: æ¶ˆæ¯å‘é€æˆåŠŸ

  /room/{roomId}/invite:
    post:
      tags:
        - ç¾¤èŠ
      summary: é‚€è¯·æˆå‘˜åŠ å…¥ç¾¤èŠ
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                memberIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: é‚€è¯·æˆåŠŸ

  /room/{roomId}/leave:
    post:
      tags:
        - ç¾¤èŠ
      summary: é€€å‡ºç¾¤èŠ
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: é€€å‡ºæˆåŠŸ

  # æ–‡ä»¶ä¸Šä¼ 
  /api/upload:
    post:
      tags:
        - æ–‡ä»¶ç®¡ç†
      summary: ä¸Šä¼ æ–‡ä»¶
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: è¦ä¸Šä¼ çš„æ–‡ä»¶
      responses:
        '200':
          description: æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"
                  fileUrl:
                    type: string
                    description: æ–‡ä»¶è®¿é—®URL
                    example: "/uploads/file-1642345678901-123456789.jpg"
                  fileName:
                    type: string
                    description: åŸå§‹æ–‡ä»¶å
                    example: "photo.jpg"
                  fileSize:
                    type: number
                    description: æ–‡ä»¶å¤§å°(å­—èŠ‚)
                    example: 1024000
                  fileType:
                    type: string
                    description: æ–‡ä»¶MIMEç±»å‹
                    example: "image/jpeg"
                  uploadTime:
                    type: string
                    format: date-time
                    description: ä¸Šä¼ æ—¶é—´
                    example: "2024-01-15T10:30:00.000Z"
        '400':
          description: æ–‡ä»¶ä¸Šä¼ å¤±è´¥
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹"
        '413':
          description: æ–‡ä»¶è¿‡å¤§
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "æ–‡ä»¶å¤§å°è¶…è¿‡10MBé™åˆ¶"

  /api/upload/file/{filename}:
    get:
      tags:
        - æ–‡ä»¶ç®¡ç†
      summary: è·å–æ–‡ä»¶
      security: []
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: æ–‡ä»¶å†…å®¹
          content:
            '*/*':
              schema:
                type: string
                format: binary

    delete:
      tags:
        - æ–‡ä»¶ç®¡ç†
      summary: åˆ é™¤æ–‡ä»¶
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: æ–‡ä»¶åˆ é™¤æˆåŠŸ

  # AIç›¸å…³æ¥å£
  /api/deepseek-chat:
    post:
      tags:
        - AIåŠ©æ‰‹
      summary: AIèŠå¤©å¯¹è¯
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  description: ç”¨æˆ·æ¶ˆæ¯
                model:
                  type: string
                  default: deepseek-chat
                temperature:
                  type: number
                  minimum: 0
                  maximum: 1
                  default: 0.7
      responses:
        '200':
          description: AIå›å¤æˆåŠŸ

  /api/conversation/history:
    get:
      tags:
        - AIåŠ©æ‰‹
      summary: è·å–å¯¹è¯å†å²
      responses:
        '200':
          description: æˆåŠŸè·å–å¯¹è¯å†å²

    delete:
      tags:
        - AIåŠ©æ‰‹
      summary: æ¸…ç©ºå¯¹è¯å†å²
      responses:
        '200':
          description: æ¸…ç©ºæˆåŠŸ

  /api/conversation/roles:
    get:
      tags:
        - AIåŠ©æ‰‹
      summary: è·å–å¯ç”¨è§’è‰²åˆ—è¡¨
      responses:
        '200':
          description: æˆåŠŸè·å–è§’è‰²åˆ—è¡¨

  # Agentç›¸å…³æ¥å£
  /api/agent/summarize:
    post:
      tags:
        - AI Agent
      summary: ç”ŸæˆèŠå¤©æ€»ç»“
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - chatType
              properties:
                chatType:
                  type: string
                  enum: [private, group]
                targetId:
                  type: string
                  description: ç§èŠå¯¹æ–¹ç”¨æˆ·ID (chatType=privateæ—¶å¿…å¡«)
                roomId:
                  type: string
                  description: ç¾¤ID (chatType=groupæ—¶å¿…å¡«)
                timeRange:
                  type: object
                  properties:
                    start:
                      type: string
                      format: date-time
                    end:
                      type: string
                      format: date-time
                limit:
                  type: integer
                  default: 100
                  description: æ¶ˆæ¯æ•°é‡é™åˆ¶
      responses:
        '200':
          description: æ€»ç»“ç”ŸæˆæˆåŠŸ

  /api/agent/chat:
    post:
      tags:
        - AI Agent
      summary: æ™ºèƒ½é—®ç­”
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - question
              properties:
                question:
                  type: string
                  description: é—®é¢˜
                chatType:
                  type: string
                  enum: [private, group]
                targetId:
                  type: string
                roomId:
                  type: string
                useContext:
                  type: boolean
                  default: true
                sessionId:
                  type: string
      responses:
        '200':
          description: é—®ç­”æˆåŠŸ

  /api/agent/explain:
    post:
      tags:
        - AI Agent
      summary: AIè§£é‡Šæ–‡æœ¬
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - text
              properties:
                text:
                  type: string
                  description: è¦è§£é‡Šçš„æ–‡æœ¬
      responses:
        '200':
          description: è§£é‡ŠæˆåŠŸ

tags:
  - name: ç”¨æˆ·è®¤è¯
    description: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ç›¸å…³æ¥å£
  - name: OAuthè®¤è¯
    description: Googleã€GitHubç­‰ç¬¬ä¸‰æ–¹ç™»å½•
  - name: ç”¨æˆ·ç®¡ç†
    description: ç”¨æˆ·ä¿¡æ¯ç®¡ç†ã€å¥½å‹ç®¡ç†
  - name: ç§èŠ
    description: ç§èŠæ¶ˆæ¯ç›¸å…³æ¥å£
  - name: ç¾¤èŠ
    description: ç¾¤èŠç®¡ç†å’Œæ¶ˆæ¯æ¥å£
  - name: æ–‡ä»¶ç®¡ç†
    description: æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤
  - name: AIåŠ©æ‰‹
    description: AIå¯¹è¯å’Œå†å²ç®¡ç†
  - name: AI Agent
    description: æ™ºèƒ½æ€»ç»“ã€é—®ç­”ã€æ–‡æœ¬è§£é‡Š
  - name: WebSocketäº‹ä»¶
    description: Socket.IOå®æ—¶é€šä¿¡äº‹ä»¶ - è¿æ¥åœ°å€ ws://localhost:3000

# WebSocket äº‹ä»¶æ–‡æ¡£
# æ³¨æ„ï¼šä»¥ä¸‹ä¸æ˜¯REST APIï¼Œè€Œæ˜¯Socket.IOäº‹ä»¶
# è¿æ¥åœ°å€ï¼šws://localhost:3000 æˆ– wss://your-domain.com
# 
# ==================== è¿æ¥ç®¡ç†äº‹ä»¶ ====================
# 
# å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯äº‹ä»¶ï¼š
# 
# connect (è‡ªåŠ¨è§¦å‘)
# - æè¿°: å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨
# - å‚æ•°: æ— 
# 
# login
# - æè¿°: ç”¨æˆ·ç™»å½•äº‹ä»¶
# - å‚æ•°: userId (string) - ç”¨æˆ·ID
# - ç¤ºä¾‹: socket.emit('login', '1642345678901')
# 
# user-online
# - æè¿°: ç”¨æˆ·ä¸»åŠ¨ä¸Šçº¿
# - å‚æ•°: userId (string) - ç”¨æˆ·ID
# 
# user-offline  
# - æè¿°: ç”¨æˆ·ä¸»åŠ¨ç¦»çº¿
# - å‚æ•°: userId (string) - ç”¨æˆ·ID
# 
# disconnect (è‡ªåŠ¨è§¦å‘)
# - æè¿°: å®¢æˆ·ç«¯æ–­å¼€è¿æ¥
# - å‚æ•°: æ— 
# 
# æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯äº‹ä»¶ï¼š
# 
# user-online-notification
# - æè¿°: ç”¨æˆ·ä¸Šçº¿é€šçŸ¥
# - æ•°æ®: userId (string) - ä¸Šçº¿ç”¨æˆ·ID
# 
# user-offline-notification
# - æè¿°: ç”¨æˆ·ç¦»çº¿é€šçŸ¥  
# - æ•°æ®: userId (string) - ç¦»çº¿ç”¨æˆ·ID
# 
# online-users-update
# - æè¿°: åœ¨çº¿ç”¨æˆ·åˆ—è¡¨æ›´æ–°
# - æ•°æ®: userIds (string[]) - åœ¨çº¿ç”¨æˆ·IDæ•°ç»„
# 
# ==================== ç§èŠæ¶ˆæ¯äº‹ä»¶ ====================
# 
# å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯äº‹ä»¶ï¼š
# 
# private-message
# - æè¿°: å‘é€ç§èŠæ¶ˆæ¯
# - å‚æ•°: {
#     from: string,        // å‘é€è€…ID
#     to: string,          // æ¥æ”¶è€…ID
#     content: string,     // æ¶ˆæ¯å†…å®¹
#     messageType: 'text' | 'image' | 'file' | 'voice',
#     timestamp: string    // ISOæ—¶é—´æˆ³
#   }
# 
# private-file-message
# - æè¿°: å‘é€ç§èŠæ–‡ä»¶æ¶ˆæ¯
# - å‚æ•°: {
#     to: string,          // æ¥æ”¶è€…ID
#     fileUrl: string,     // æ–‡ä»¶URL
#     fileName: string,    // æ–‡ä»¶å
#     fileType: string,    // MIMEç±»å‹
#     messageType: 'image' | 'file' | 'voice'
#   }
# 
# message-deleted
# - æè¿°: åˆ é™¤å•æ¡æ¶ˆæ¯
# - å‚æ•°: {
#     messageId: string,   // æ¶ˆæ¯ID
#     chatWith: string     // èŠå¤©å¯¹è±¡ID
#   }
# 
# messages-deleted
# - æè¿°: æ‰¹é‡åˆ é™¤æ¶ˆæ¯
# - å‚æ•°: {
#     messageIds: string[], // æ¶ˆæ¯IDæ•°ç»„
#     chatWith: string      // èŠå¤©å¯¹è±¡ID
#   }
# 
# æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯äº‹ä»¶ï¼š
# 
# private-message
# - æè¿°: æ¥æ”¶ç§èŠæ¶ˆæ¯
# - æ•°æ®: {
#     from: string,
#     to: string,
#     content: string,
#     messageType: string,
#     timestamp: string
#   }
# 
# private-file-message
# - æè¿°: æ¥æ”¶æ–‡ä»¶æ¶ˆæ¯
# - æ•°æ®: {
#     from: string,
#     fileUrl: string,
#     fileName: string,
#     fileType: string,
#     messageType: string
#   }
# 
# message-deleted
# - æè¿°: æ¶ˆæ¯åˆ é™¤é€šçŸ¥
# - æ•°æ®: {
#     messageId: string,
#     chatWith: string
#   }
# 
# private-message-recalled
# - æè¿°: æ¶ˆæ¯æ’¤å›é€šçŸ¥
# - æ•°æ®: {
#     messageId: string,
#     chatWith: string,
#     userId: string
#   }
# 
# avatar-updated
# - æè¿°: å¤´åƒæ›´æ–°é€šçŸ¥
# - æ•°æ®: {
#     userId: string,
#     newAvatarUrl: string
#   }
# 
# ==================== ç¾¤èŠæ¶ˆæ¯äº‹ä»¶ ====================
# 
# å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯äº‹ä»¶ï¼š
# 
# join-group
# - æè¿°: åŠ å…¥ç¾¤èŠ
# - å‚æ•°: {
#     roomId: string,      // ç¾¤èŠID
#     userId: string       // ç”¨æˆ·ID
#   }
# 
# leave-group
# - æè¿°: ç¦»å¼€ç¾¤èŠ
# - å‚æ•°: {
#     roomId: string,
#     userId: string
#   }
# 
# group-message
# - æè¿°: å‘é€ç¾¤èŠæ¶ˆæ¯
# - å‚æ•°: {
#     roomId: string,      // ç¾¤èŠID
#     from: string,        // å‘é€è€…ID
#     senderName: string,  // å‘é€è€…åç§°
#     content: string,     // æ¶ˆæ¯å†…å®¹
#     messageType: 'text' | 'image' | 'file' | 'voice' | 'system',
#     fromAvatar?: string  // å‘é€è€…å¤´åƒ
#   }
# 
# group-message-read
# - æè¿°: æ ‡è®°ç¾¤æ¶ˆæ¯å·²è¯»
# - å‚æ•°: {
#     roomId: string,
#     messageId: string,
#     userId: string
#   }
# 
# group-typing
# - æè¿°: å¼€å§‹è¾“å…¥çŠ¶æ€
# - å‚æ•°: {
#     roomId: string,
#     userId: string,
#     userName: string
#   }
# 
# group-stop-typing
# - æè¿°: åœæ­¢è¾“å…¥çŠ¶æ€
# - å‚æ•°: {
#     roomId: string,
#     userId: string
#   }
# 
# group-message-recall
# - æè¿°: æ’¤å›ç¾¤èŠæ¶ˆæ¯
# - å‚æ•°: {
#     roomId: string,
#     messageId: string
#   }
# 
# æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯äº‹ä»¶ï¼š
# 
# member-joined
# - æè¿°: æˆå‘˜åŠ å…¥é€šçŸ¥
# - æ•°æ®: {
#     userId: string,
#     timestamp: Date
#   }
# 
# member-left
# - æè¿°: æˆå‘˜ç¦»å¼€é€šçŸ¥
# - æ•°æ®: {
#     userId: string,
#     timestamp: Date
#   }
# 
# online-count
# - æè¿°: åœ¨çº¿äººæ•°æ›´æ–°
# - æ•°æ®: {
#     count: number
#   }
# 
# group-message
# - æè¿°: æ¥æ”¶ç¾¤èŠæ¶ˆæ¯
# - æ•°æ®: {
#     roomId: string,
#     from: string,
#     senderName: string,
#     content: string,
#     messageType: string,
#     fromAvatar: string,
#     timestamp: Date
#   }
# 
# group-message-read
# - æè¿°: ç¾¤æ¶ˆæ¯å·²è¯»é€šçŸ¥
# - æ•°æ®: {
#     messageId: string,
#     userId: string,
#     timestamp: Date
#   }
# 
# group-typing
# - æè¿°: æœ‰äººæ­£åœ¨è¾“å…¥
# - æ•°æ®: {
#     userId: string,
#     userName: string,
#     timestamp: Date
#   }
# 
# group-stop-typing
# - æè¿°: åœæ­¢è¾“å…¥é€šçŸ¥
# - æ•°æ®: {
#     userId: string,
#     timestamp: Date
#   }
# 
# group-message-recalled
# - æè¿°: ç¾¤æ¶ˆæ¯æ’¤å›é€šçŸ¥
# - æ•°æ®: {
#     messageId: string,
#     timestamp: Date
#   }
# 
# ==================== é”™è¯¯äº‹ä»¶ ====================
# 
# error
# - æè¿°: æœåŠ¡ç«¯é”™è¯¯é€šçŸ¥
# - æ•°æ®: {
#     message: string,     // é”™è¯¯æ¶ˆæ¯
#     code?: string,       // é”™è¯¯ä»£ç 
#     details?: any        // é”™è¯¯è¯¦æƒ…
#   }
# 
# ==================== è¿æ¥ç¤ºä¾‹ ====================
# 
# // å‰ç«¯è¿æ¥ç¤ºä¾‹
# import { io } from 'socket.io-client'
# 
# const socket = io('http://localhost:3000', {
#   withCredentials: true,
#   transports: ['websocket', 'polling']
# })
# 
# // ç™»å½•
# socket.emit('login', localStorage.getItem('userId'))
# 
# // ç›‘å¬æ¶ˆæ¯
# socket.on('private-message', (data) => {
#   console.log('æ”¶åˆ°ç§èŠæ¶ˆæ¯:', data)
# })
# 
# // å‘é€æ¶ˆæ¯
# socket.emit('private-message', {
#   from: 'user1',
#   to: 'user2', 
#   content: 'ä½ å¥½',
#   messageType: 'text',
#   timestamp: new Date().toISOString()
# })
# 
# // åŠ å…¥ç¾¤èŠ
# socket.emit('join-group', {
#   roomId: 'group_123',
#   userId: 'user1'
# })
# 
# ==================== æ³¨æ„äº‹é¡¹ ====================
# 
# 1. è¿æ¥åœ°å€: ws://localhost:3000 (å¼€å‘ç¯å¢ƒ)
# 2. æ”¯æŒå¤šè®¾å¤‡ç™»å½•: ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªsocketè¿æ¥
# 3. æ¶ˆæ¯å¯é æ€§: ç§èŠæ¶ˆæ¯é‡‡ç”¨HTTP+SocketåŒè½¨åˆ¶
# 4. ç¾¤èŠæˆ¿é—´: ä½¿ç”¨Socket.IOçš„roomæœºåˆ¶
# 5. è®¤è¯: è¿æ¥åéœ€è¦å‘é€loginäº‹ä»¶è¿›è¡Œèº«ä»½éªŒè¯
# 6. é”™è¯¯å¤„ç†: æ‰€æœ‰äº‹ä»¶éƒ½åŒ…å«é€‚å½“çš„é”™è¯¯å¤„ç†
